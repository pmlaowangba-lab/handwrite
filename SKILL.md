---
name: text-to-handwriting
description: 将文本内容转换为手写体效果的网页，支持 AI 润色、本地字体、随机涂改等参数，适合录屏拍视频使用。
version: 3.0.0
---

# Text to Handwriting Generator v3.0

> 输入文本 → AI 润色扩展 → 生成手写体网页 → 实时预览 → 录屏拍视频

## 📌 触发条件 (Trigger)

- **场景**：用户想要生成手写体效果的内容，用于视频录制
- **关键词**：`生成手写体`、`手写效果`、`handwriting`、`手写网页`、`AI 润色`
- **输入**：任何文本内容（短句、文章、笔记等）
- **输出**：包含手写效果的 HTML 网页，自动在浏览器打开

## ⚙️ 核心规则 (Core Rules)

### 功能模块

| 模块 | 功能 | 说明 |
|:---|:---|:---|
| **🤖 AI 润色** | 接入大模型 API，自动扩展文案 | 500 字+，专业风格，无 Emoji |
| **文本输入** | 支持直接输入或粘贴文本 | 支持多行文本 |
| **字体选择** | 13 种本地手写字体 | 清松手写体系列、沐瑶手写体等 |
| **纸张尺寸** | A4/B5/A3 纸张 | 支持纵向和横向 (600dpi) |
| **位置偏移** | 模拟真实手写的不规则性 | 0-100% 可调 |
| **随机涂改** | 密集横线、涂黑、圈圈标记 | 模拟真实修改痕迹 |
| **实时预览** | Canvas 渲染 | 参数改变时自动刷新 |
| **导出图片** | 下载为 PNG 格式 | 高清输出 (600dpi) |

### AI 润色规则（基于 text-to-excalidraw 规范）

| 规则 | 说明 |
|:---|:---|
| **🚫 严禁 Emoji** | 生成的文本中绝对禁止包含任何 Emoji 表情 |
| **专业语言** | 使用简洁、高密度的专业语言，避免口语化 |
| **深度扩展** | 每个概念至少扩展 2-3 个支撑点，关键名词必须补充定义 |
| **多层级展开** | 标题→章节→要点→详细说明 |
| **内容量要求** | 至少 500 字，确保充实 |
| **层级清晰** | 适合手写展示，不要有过多空白内容 |
| **学术风格** | 保持严肃、专业的学术风格 |

### AI Prompt 模板

```
你是专业的学术笔记润色助手。

核心规则：
1. 🚫 严禁使用任何 Emoji 表情
2. 使用简洁、高密度的专业语言，避免口语化
3. 深度扩展内容：
   - 每个概念至少扩展 2-3 个支撑点
   - 关键名词必须补充定义或解释
   - 多层级展开（标题→要点→详细说明）
4. 输出格式：
   # 主标题（H0）
   ## 章节标题（H1）
   ### 小节标题（H2）
   正文内容...
   注：补充说明（Note）

输出要求：
- 内容量：至少 500 字，确保充实
- 层级清晰，适合手写展示，不要有过多空白内容
- 保持严肃、专业的学术风格
```

### 本地手写字体库

| 字体名称 | 文件名 | 风格 |
|:---|:---|:---|
| 清松手写体1-圆润 | 清松手寫體1：圓潤.ttf | 圆润可爱 |
| 清松手写体2-秀气 | 清松手寫體2：秀氣.ttf | 秀气清新 |
| 清松手写体3-呆萌 | 清松手寫體3：呆萌.ttf | 呆萌可爱 |
| 清松手写体4-POP | 清松手寫體4：POP.ttf | POP 风格 |
| 清松手写体5-行楷 | 清松手寫體5：行楷.ttf | 行楷风格（默认） |
| 清松手写体6-Q萌 | 清松手寫體6：Q萌.ttf | Q 萌风格 |
| 清松手写体7-飘逸 | 清松手寫體7：飄逸.ttf | 飘逸洒脱 |
| 清松手写体8-随性 | 清松手寫體8：隨性.ttf | 随性自然 |
| 沐瑶软笔手写体 | 沐瑶软笔手写体.ttf | 软笔风格 |
| 沐瑶随心手写体 | 沐瑶随心手写体.ttf | 随心风格 |
| 内海字体 | 內海字體-Regular-Lite.ttf | 日系风格 |
| 她屿山海 | 她屿山海.ttf | 文艺风格 |
| 栗壳坚坚体 | 栗壳坚坚体.ttf | 坚实风格 |

### 纸张尺寸（600dpi）

| 纸张类型 | 尺寸（像素） | 说明 |
|:---|:---|:---|
| A4纸-纵向 | 4960 x 7015 | 最常用（默认） |
| A4纸-横向 | 7015 x 4960 | 横向排版 |
| B5纸-纵向 | 4157 x 5905 | 较小尺寸 |
| B5纸-横向 | 5905 x 4157 | 横向排版 |
| A3纸-纵向 | 7015 x 9921 | 大尺寸 |
| A3纸-横向 | 9921 x 7015 | 横向排版 |

### 随机性参数

| 参数 | 范围 | 说明 |
|:---|:---|:---|
| **位置偏移度** | 0-100% | 控制每个字符的 X/Y 偏移量 |
| **随机涂改概率** | 0-100% | 控制删除线和涂抹效果的出现概率 |
| **字体粗细变化** | 0-100% | 控制字体粗细的随机变化程度 |

### 涂改效果类型（真实手写风格）

| 类型 | 说明 | 出现概率 |
|:---|:---|:---|
| **密集横线** | 4-6 条弯曲横线覆盖文字 | 60% |
| **涂黑覆盖** | 半透明矩形 + 覆盖线条 | 25% |
| **圈圈标记** | 椭圆形圈住错误字符 | 15% |

## 🔄 工作流程 (Workflow)

### Step 1: 配置 AI API（首次使用）

1. 点击「🤖 AI 润色配置」展开配置面板
2. 填写 API 配置：
   - **API Endpoint**：`https://api.anthropic.com/v1/messages`
   - **API Key**：Claude API Key（sk-ant-...）
   - **模型**：选择 Claude 3.5 Sonnet（推荐）
3. 点击「💾 保存配置」
4. 点击「🔌 测试连接」验证配置

### Step 2: 输入文本或使用 AI 润色

**方式 A：直接输入**
- 在文本框中输入或粘贴文本

**方式 B：AI 润色**
1. 输入简短文案（如「产品经理的核心能力」）
2. 点击「🤖 AI 润色文案」
3. AI 自动扩展至 500 字+，添加层级结构
4. 润色完成后自动刷新预览

### Step 3: 调整手写参数

用户在网页中：
1. 选择手写字体（13 种本地字体）
2. 选择纸张尺寸（A4/B5/A3）
3. 调整位置凌乱度（0-100%）
4. 调整字号大小（16-48px）
5. 调整行间距（1.2-3.0）
6. 调整涂改概率（0-100%）
7. 调整笔画凌乱度（0-100%）
8. 实时查看预览效果

### Step 4: 录屏或导出

用户可以：
- 使用录屏软件录制效果
- 点击「💾 下载图片」导出 PNG（600dpi 高清）

## ⚠️ 注意事项 (Pitfalls)

| 问题 | 原因 | 解决方案 |
|:---|:---|:---|
| **AI API 调用失败** | API Key 错误或网络问题 | 检查配置，使用「测试连接」功能验证 |
| **字体加载失败** | 本地字体文件路径错误 | 确保字体文件在 `assets/fonts/` 目录 |
| **Canvas 渲染模糊** | 未设置高 DPI 适配 | 使用 `devicePixelRatio` 放大 Canvas |
| **中文字符宽度计算不准** | 不同字体宽度不同 | 使用 `measureText()` 精确测量 |
| **位置偏移过大导致重叠** | 偏移参数设置不当 | 限制偏移范围在字符宽度的 20% 以内 |
| **导出图片分辨率低** | Canvas 尺寸设置过小 | 使用 600dpi 实际尺寸导出 |
| **macOS 中文路径问题** | webbrowser 模块不支持中文路径 | 使用 subprocess.run(["open", path]) |

## 📐 技术实现细节

### Canvas 渲染逻辑

```javascript
// 1. 设置高 DPI 适配
const dpr = window.devicePixelRatio || 1;
canvas.width = displayWidth * dpr;
canvas.height = displayHeight * dpr;
ctx.scale(dpr, dpr);

// 2. 绘制纸张背景
ctx.fillStyle = '#ffffff';
ctx.fillRect(0, 0, displayWidth, displayHeight);

// 3. 设置手写字体
ctx.font = `${fontSize}px "${fontFamily}"`;
ctx.fillStyle = '#1e1e1e';

// 4. 逐字渲染（添加随机偏移）
let x = startX, y = startY;
for (let char of text) {
  const offsetX = (Math.random() - 0.5) * positionJitter;
  const offsetY = (Math.random() - 0.5) * positionJitter;
  ctx.fillText(char, x + offsetX, y + offsetY);

  // 计算下一个字符位置
  const metrics = ctx.measureText(char);
  x += metrics.width + charSpacing;

  // 换行处理
  if (x > maxWidth) {
    x = startX;
    y += lineHeight;
  }
}
```

### 位置偏移算法

```javascript
// 将 0-100% 的滑块值转换为实际偏移像素
const positionJitter = (sliderValue / 100) * fontSize * 0.3;
// 例如：fontSize=24, sliderValue=50 → jitter=3.6px
```

## 📝 更新日志 (Changelog)

| 日期 | 版本 | 变更内容 |
|:---|:---|:---|
| 2026-02-11 | 3.0.0 | 新增 AI 润色功能（接入 Claude API），复用 text-to-excalidraw 文案规范 |
| 2026-02-11 | 2.0.0 | Phase 2：新增随机涂改效果（密集横线、涂黑、圈圈）和字体粗细变化功能 |
| 2026-02-11 | 1.0.0 | 初始版本：基础手写体生成功能，支持字体选择、纸张背景、位置偏移 |
